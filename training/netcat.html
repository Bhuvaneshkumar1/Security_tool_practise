<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Netcat Practice</title>

<style>
:root{
  --bg:#0b0f1a;--card:#151c38;--fg:#e8ebff;--muted:#9aa3d1;
  --accent:#4f7cff;--border:#27306a;--err:#ff5c5c;--term:#020617;
}
*{box-sizing:border-box}
body{
  margin:0;font-family:ui-monospace,Menlo,Consolas,monospace;
  background:radial-gradient(1200px 600px at 20% -10%,#141b3a 0%,var(--bg) 60%);
  color:var(--fg)
}
header{
  padding:16px 24px;border-bottom:1px solid var(--border);
  background:#0b1024
}
header h1{margin:0;font-size:22px}
header small{color:var(--muted)}
main{max-width:900px;margin:auto;padding:24px}
.card{
  background:linear-gradient(180deg,var(--card),#0f1533);
  border:1px solid var(--border);border-radius:14px;padding:20px
}
h2{margin:0 0 14px;color:#00e5ff;font-size:16px}
label{display:block;margin-top:10px;color:var(--muted);font-size:12px}
input,textarea{
  width:100%;margin-top:4px;padding:10px;border-radius:8px;
  border:1px solid var(--border);background:#060b20;color:var(--fg)
}
textarea{min-height:80px}
button{
  width:100%;margin-top:14px;padding:12px;border-radius:10px;
  border:none;background:linear-gradient(135deg,var(--accent),#2e4bff);
  color:white;font-weight:700;cursor:pointer
}
pre{
  background:linear-gradient(180deg,var(--term),#020617);
  border:1px solid #1e293b;border-radius:12px;
  padding:14px;height:260px;overflow:auto;font-size:13px
}
pre::before{
  content:"terminal";display:block;color:#64748b;
  font-size:11px;margin-bottom:6px
}
.hidden{display:none}
</style>
</head>

<body>

<header>
  <h1 id="title">Netcat</h1>
  <small id="subtitle"></small>
</header>

<main>

<!-- LISTENER -->
<div id="listener" class="card hidden">
<h2>Listener (nc -l)</h2>

<label>Listen Port</label>
<input id="l_port" value="4444">

<button id="listen">START LISTENER</button>

<pre id="l_out">—</pre>
</div>

<!-- CLIENT -->
<div id="client" class="card hidden">
<h2>Client (nc host port)</h2>

<label>Target Host</label>
<input id="c_host" value="127.0.0.1">

<label>Target Port</label>
<input id="c_port" value="4444">

<label>Message</label>
<textarea id="c_msg">hello</textarea>

<button id="connect">CONNECT & SEND</button>

<pre id="c_out">—</pre>
</div>

</main>

<script>
(() => {
const path = location.pathname;

const listenerUI = document.getElementById("listener");
const clientUI   = document.getElementById("client");
const title      = document.getElementById("title");
const subtitle   = document.getElementById("subtitle");

if (path.endsWith("/listener")) {
  listenerUI.classList.remove("hidden");
  title.textContent = "Netcat Listener";
  subtitle.textContent = "Waiting side";
}

if (path.endsWith("/client")) {
  clientUI.classList.remove("hidden");
  title.textContent = "Netcat Client";
  subtitle.textContent = "Connecting side";
}

/* Listener */
document.getElementById("listen")?.addEventListener("click", async () => {
  const out = document.getElementById("l_out");
  out.textContent = "Listening…";

  const res = await fetch("/run/netcat/listen", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ port: parseInt(l_port.value) })
  });

  const data = await res.json();
  out.textContent = data.stdout || data.stderr || "No output";
});

/* Client */
document.getElementById("connect")?.addEventListener("click", async () => {
  const out = document.getElementById("c_out");
  out.textContent = "Connecting…";

  const res = await fetch("/run/netcat/connect", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      host: c_host.value,
      port: parseInt(c_port.value),
      message: c_msg.value
    })
  });

  const data = await res.json();
  out.textContent = data.stdout || data.stderr || "No output";
});
})();
</script>

</body>
</html>
