<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SQLMap – SQL Injection Learning Lab</title>

<style>
/* ===== HARD PAGE LOCK ===== */
html, body {
  width: 100%;
  max-width: 100%;
  overflow-x: hidden !important;
}

/* ===== THEME ===== */
:root{
  --bg:#0b0f1a;
  --panel:#151c38;
  --fg:#e8ebff;
  --muted:#9aa3d1;
  --accent:#22c55e;
  --border:#27306a;
  --error:#ef4444;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family: ui-monospace, Menlo, Consolas, monospace;
  background: radial-gradient(1200px 600px at 20% -10%, #141b3a 0%, var(--bg) 60%);
  color: var(--fg);
}

/* ===== HEADER ===== */
header{
  padding:18px 24px;
  border-bottom:1px solid var(--border);
  background:#0b1024;
}
header h1{margin:0;font-size:22px}
header small{color:var(--muted)}

/* ===== LAYOUT ===== */
main{
  max-width:1100px;
  width:100%;
  margin:auto;
  padding:24px;
  overflow-x:hidden;
}

/* ===== SECTIONS ===== */
.section{
  background:linear-gradient(180deg,var(--panel),#0f1533);
  border:1px solid var(--border);
  border-radius:14px;
  margin-bottom:20px;
  padding:22px;

  /* FIREFOX FIX */
  min-width: 0;
}

.section h2{
  margin:0 0 14px;
  color:var(--accent);
  font-size:18px;
}

label{
  display:block;
  font-size:13px;
  margin-bottom:6px;
  color:var(--muted);
}

input,select,button{
  width:100%;
  padding:10px;
  border-radius:8px;
  border:1px solid var(--border);
  background:#020617;
  color:var(--fg);
  margin-bottom:12px;
}

button{
  background:linear-gradient(135deg,#22c55e,#16a34a);
  border:none;
  font-weight:700;
  cursor:pointer;
}

button:hover{opacity:.9}

/* ===== COMMAND ===== */
.command{
  font-size:13px;
  padding:10px;
  background:#020617;
  border:1px solid #1e293b;
  border-radius:10px;

  word-break: break-all;
  max-inline-size: 100%;
}

/* ===== OUTPUT (FIREFOX-PROOF) ===== */
.output-grid{
  display:grid;
  grid-template-columns: 1fr;

  width:100%;
  max-width:100%;
  min-width:0;              /* KEY FIX */
  overflow:hidden;
}

.terminal{
  background:#020617;
  border:1px solid #1e293b;
  border-radius:12px;
  padding:14px;

  height:420px;
  overflow-y:auto;
  overflow-x:hidden;

  font-size:13px;
  line-height:1.5;

  min-width:0;              /* KEY FIX */
  max-inline-size:100%;     /* KEY FIX */
}

.line{
  white-space:pre-wrap;
  word-break:break-all;
  max-inline-size:100%;
}

/* ===== ERROR ===== */
.error{
  color:var(--error);
  font-size:13px;
  margin-top:6px;
}
</style>
</head>

<body data-lesson="sqlmap">

<header>
  <h1>SQLMap</h1>
  <small>SQL Injection automation — guided & safe execution</small>
</header>

<main>

<section class="section">
<h2>Run SQLMap (Safe Mode)</h2>

<label>Target URL</label>
<input id="url"
  placeholder="Enter target URL (e.g., http://example.com/page.php?id=1)"
  value="http://testphp.vulnweb.com/listproducts.php?cat=1&id=2">

<label for="action">Action</label>
<select id="action" name="action">
  <option value="">Detect Injection</option>
  <option value="--dbs">Enumerate Databases</option>
  <option value="--tables">Enumerate Tables</option>
</select>

<button id="run">Run SQLMap</button>

<div class="command" id="cmd">— command will appear here —</div>
</section>

<section class="section">
<h2>Output</h2>

<div class="output-grid">
  <div class="terminal" id="terminal"></div>
</div>

<div id="err" class="error"></div>
</section>

</main>

<script>
document.getElementById("run").onclick = async () => {
  const term = document.getElementById("terminal");
  const err = document.getElementById("err");
  const cmd = document.getElementById("cmd");

  term.innerHTML = "";
  err.textContent = "";

  const url = document.getElementById("url").value.trim();
  const action = document.getElementById("action").value;

  cmd.textContent =
    `sqlmap -u "${url}" ${action} --batch --level=1 --risk=1`;

  try{
    const res = await fetch("/run/sqlmap",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({url, action})
    });

    const text = await res.text();
    let data;
    try { data = JSON.parse(text); }
    catch { data = {stderr:text}; }

    const output = data.stdout || data.stderr || "No output";

    output.split("\n").forEach(line=>{
      const div = document.createElement("div");
      div.className = "line";
      div.textContent = line;
      term.appendChild(div);
    });

    term.scrollTop = term.scrollHeight;

    if(!res.ok){
      err.textContent = data.detail || "Execution error";
    }
  }
  catch{
    err.textContent = "Backend unreachable";
  }
};
</script>
<script src="/static/lesson_tracker.js"></script>
</body>
</html>
