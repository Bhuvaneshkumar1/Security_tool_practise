<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Nmap Practice – Optimized</title>

<style>
:root{--bg:#0e111a;--card:#151a2d;--fg:#e6e8f0;--muted:#9aa1c7;--accent:#3b6cff;--error:#ff5c5c}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,Arial;background:var(--bg);color:var(--fg)}
main{max-width:1100px;margin:auto;padding:16px}
.card{background:var(--card);border:1px solid #262b55;border-radius:8px;padding:16px;margin-bottom:16px}
h1,h2{margin:0 0 10px}
ul{margin:0 0 10px 18px;padding:0}
li{margin:6px 0;cursor:pointer}
li:hover{color:var(--accent)}
code{background:#0a0d1a;padding:2px 5px;border-radius:4px}
label{display:block;margin-top:8px}
input,select,button{
 width:100%;padding:8px;border-radius:6px;
 border:1px solid #262b55;background:#0a0d1a;color:var(--fg)
}
button{margin-top:12px;background:var(--accent);border:none;font-weight:600}
pre{background:#0a0d1a;border:1px solid #262b55;border-radius:6px;padding:12px;white-space:pre-wrap}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
small{color:var(--muted)}
.error{color:var(--error)}
</style>
</head>

<body>
<main>

<div class="card">
<h1>Nmap Practice – Optimized Learning Mode</h1>
<small>Live execution via backend</small>
</div>

<div class="card">
<h2>Command Reference</h2>
<ul id="ref"></ul>
</div>

<div class="card">
<h2>Command Builder</h2>

<div class="grid">
<div>
<label>Target</label>
<input id="target" placeholder="IP / CIDR / Domain">
</div>
<div>
<label for="preset">Preset</label>
<select id="preset"></select>
</div>
</div>

<label>Ports</label>
<input id="ports" placeholder="22,80,443">

<label>Extra Flags</label>
<input id="extra" placeholder="-Pn -v">

<button id="build">Run Nmap</button>
</div>

<div class="card">
<h2>Output</h2>
<pre id="out">—</pre>
</div>

</main>

<script>
(() => {
const data = [
 {name:"Basic scan", flags:""},
 {name:"Ping scan", flags:"-sn"},
 {name:"Port scan", flags:"-p 22,80,443"},
 {name:"Verbose", flags:"-v"},
 {name:"Service detection", flags:"-sV"},
 {name:"OS detection", flags:"-O"},
 {name:"Default scripts", flags:"-sC"},
 {name:"Aggressive", flags:"-A"},
 {name:"TCP SYN", flags:"-sS"},
 {name:"UDP", flags:"-sU"}
];

const $ = id => document.getElementById(id);
const ref = $('ref');
const preset = $('preset');
const out = $('out');

preset.innerHTML = `<option value="">Custom</option>`;

data.forEach((d,i)=>{
  const li = document.createElement('li');
  li.innerHTML = `<b>${d.name}</b> – <code>nmap ${d.flags || "target"}</code>`;
  li.onclick = () => preset.selectedIndex = i + 1;
  ref.appendChild(li);

  const o = document.createElement('option');
  o.value = d.flags;
  o.textContent = d.name;
  preset.appendChild(o);
});

$('build').onclick = async () => {
  out.classList.remove("error");
  out.textContent = "Running…";

  const target = $('target').value.trim();
  if (!target) {
    out.textContent = "Error: Target is required";
    out.classList.add("error");
    return;
  }

  const args = [];
  if (preset.value) args.push(preset.value);
  if ($('ports').value) args.push("-p", $('ports').value.trim());
  if ($('extra').value) args.push($('extra').value.trim());
  args.push(target);

  try {
    const res = await fetch("/run/nmap", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ args: args.join(" ") })
    });

    const text = await res.text();
    let payload;
    try { payload = JSON.parse(text); } catch { payload = { stderr: text }; }

    if (!res.ok) {
      out.textContent = payload.detail || payload.stderr || "Backend error";
      out.classList.add("error");
      return;
    }

    out.textContent = payload.stdout || payload.stderr || "No output";
    if (payload.stderr) out.classList.add("error");

  } catch (e) {
    out.textContent = "Network / backend unreachable";
    out.classList.add("error");
  }
};

})();
</script>

</body>
</html>
