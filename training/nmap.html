<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Nmap Practice – Optimized</title>

<style>
:root{
  --bg:#0b0f1a;
  --panel:#11172a;
  --card:#151c38;
  --fg:#e8ebff;
  --muted:#9aa3d1;
  --accent:#4f7cff;
  --accent-2:#00e5ff;
  --border:#27306a;
  --error:#ff5c5c;
  --success:#00ff9c;
  --terminal:#020617;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  background:radial-gradient(1200px 600px at 20% -10%,#141b3a 0%,var(--bg) 60%);
  color:var(--fg);
}

header{
  position:sticky;
  top:0;
  z-index:10;
  background:linear-gradient(90deg,#0b1024,#111944);
  border-bottom:1px solid var(--border);
}

header h1{
  margin:0;
  padding:16px 24px 4px;
  font-size:22px;
}

header small{
  display:block;
  padding:0 24px 14px;
  color:var(--muted);
}

main{
  max-width:1400px;
  margin:auto;
  padding:24px;
  display:grid;
  grid-template-columns: 2fr 1fr;
  gap:20px;
}

.card{
  background:linear-gradient(180deg,var(--card),#0f1533);
  border:1px solid var(--border);
  border-radius:12px;
  padding:18px;
  box-shadow:0 10px 40px rgba(0,0,0,.35);
}

h2{
  margin:0 0 14px;
  font-size:16px;
  color:var(--accent-2);
  letter-spacing:.5px;
}

label{
  display:block;
  margin-top:10px;
  font-size:12px;
  color:var(--muted);
}

input,select{
  width:100%;
  margin-top:4px;
  padding:10px 12px;
  border-radius:8px;
  border:1px solid var(--border);
  background:#060b20;
  color:var(--fg);
}

input:focus,select:focus{
  outline:none;
  border-color:var(--accent);
}

button{
  width:100%;
  margin-top:14px;
  padding:12px;
  border-radius:10px;
  border:none;
  background:linear-gradient(135deg,var(--accent),#2e4bff);
  color:white;
  font-weight:700;
  letter-spacing:.6px;
  cursor:pointer;
}

button:hover{
  filter:brightness(1.1);
}

.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:14px;
}

ul{
  list-style:none;
  padding:0;
  margin:0;
}

li{
  padding:8px 10px;
  margin-bottom:6px;
  border-radius:6px;
  border:1px solid transparent;
  cursor:pointer;
}

li:hover{
  background:#0b1230;
  border-color:var(--border);
}

code{
  background:#050818;
  padding:2px 6px;
  border-radius:4px;
  color:var(--accent-2);
}

pre{
  background:linear-gradient(180deg,var(--terminal),#020617);
  border:1px solid #1e293b;
  border-radius:12px;
  padding:16px;
  height:320px;
  overflow:auto;
  font-size:13px;
  line-height:1.5;
  color:#c7d2fe;
}

pre::before{
  content:"terminal";
  display:block;
  color:#64748b;
  font-size:11px;
  margin-bottom:6px;
}

.error{
  color:var(--error);
}

@media(max-width:1000px){
  main{grid-template-columns:1fr}
}
</style>
</head>

<body>

<header>
  <h1>Nmap Practice Console</h1>
  <small>Interactive backend-powered reconnaissance environment</small>
</header>

<main>

<!-- LEFT COLUMN -->
<div class="card">
<h2>Command Builder</h2>

<div class="grid">
<div>
<label>Target</label>
<input id="target" placeholder="IP / CIDR / Domain">
</div>
<div>
<label>Preset</label>
<select id="preset" title="Select a preset nmap scan configuration"></select>
</div>
</div>

<label>Ports</label>
<input id="ports" placeholder="22,80,443">

<label>Extra Flags</label>
<input id="extra" placeholder="-Pn -v">

<button id="build">RUN NMAP</button>
</div>

<!-- RIGHT COLUMN -->
<div class="card">
<h2>Command Reference</h2>
<ul id="ref"></ul>
</div>

<!-- FULL WIDTH OUTPUT -->
<div class="card" style="grid-column:1/-1">
<h2>Output</h2>
<pre id="out">—</pre>
</div>

</main>

<script>
(() => {
const data = [
 {name:"Basic scan", flags:""},
 {name:"Ping scan", flags:"-sn"},
 {name:"Port scan", flags:"-p 22,80,443"},
 {name:"Verbose", flags:"-v"},
 {name:"Service detection", flags:"-sV"},
 {name:"OS detection", flags:"-O"},
 {name:"Default scripts", flags:"-sC"},
 {name:"Aggressive", flags:"-A"},
 {name:"TCP SYN", flags:"-sS"},
 {name:"UDP", flags:"-sU"}
];

const $ = id => document.getElementById(id);
const ref = $('ref');
const preset = $('preset');
const out = $('out');

preset.innerHTML = `<option value="">Custom</option>`;

data.forEach((d,i)=>{
  const li = document.createElement('li');
  li.innerHTML = `<b>${d.name}</b><br><code>nmap ${d.flags || "target"}</code>`;
  li.onclick = () => preset.selectedIndex = i + 1;
  ref.appendChild(li);

  const o = document.createElement('option');
  o.value = d.flags;
  o.textContent = d.name;
  preset.appendChild(o);
});

$('build').onclick = async () => {
  out.classList.remove("error");
  out.textContent = "Running…";

  const target = $('target').value.trim();
  if (!target) {
    out.textContent = "Error: Target is required";
    out.classList.add("error");
    return;
  }

  const args = [];
  if (preset.value) args.push(preset.value);
  if ($('ports').value) args.push("-p", $('ports').value.trim());
  if ($('extra').value) args.push($('extra').value.trim());
  args.push(target);

  try {
    const res = await fetch("/run/nmap", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ args: args.join(" ") })
    });

    const text = await res.text();
    let payload;
    try { payload = JSON.parse(text); } catch { payload = { stderr: text }; }

    if (!res.ok) {
      out.textContent = payload.detail || payload.stderr || "Backend error";
      out.classList.add("error");
      return;
    }

    out.textContent = payload.stdout || payload.stderr || "No output";
    if (payload.stderr) out.classList.add("error");

  } catch (e) {
    out.textContent = "Network / backend unreachable";
    out.classList.add("error");
  }
};

})();
</script>
<script src="/static/lesson_tracker.js"></script>
</body>
</html>
